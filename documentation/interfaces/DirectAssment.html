<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>PSIRS documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">PSIRS documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  DirectAssment</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/shared/models/payee_calculator.ts</code>
        </p>




        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#cra" 
>
                                            cra
                                        </a>
                                </li>
                                <li>
                                        <a href="#gi" 
>
                                            gi
                                        </a>
                                </li>
                                <li>
                                        <a href="#tax" 
>
                                            tax
                                        </a>
                                </li>
                                <li>
                                        <a href="#ti" 
>
                                            ti
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="cra"></a>
                                        <span class="name "><b>cra</b>
                                            <a href="#cra">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>cra:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="gi"></a>
                                        <span class="name "><b>gi</b>
                                            <a href="#gi">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>gi:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="tax"></a>
                                        <span class="name "><b>tax</b>
                                            <a href="#tax">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>tax:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="ti"></a>
                                        <span class="name "><b>ti</b>
                                            <a href="#ti">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>ti:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Console } from &quot;console&quot;;

export interface DirectAssment {
  gi: number;
  cra: number;
  ti: number;
  tax: number;
}

export class PayeeCalculator {
  public gross_income: number;
  public taxable_income: number;
  public total_deductions: number;
  public tax: number;
  public allowable_deduction_pension &#x3D; 0;
  public allowable_deduction_nhf &#x3D; 0;
  public cra &#x3D; 0;
  public nhs &#x3D; 0;
  public li &#x3D; 0;
  public pe &#x3D; 0;
  public nhis &#x3D; 0;
  public dev_levy &#x3D; 0;

  public CalculateDirectAssessment(value) {
    let directAss: DirectAssment &#x3D; {
      gi: 0,
      cra: 0,
      ti: 0,
      tax: 0,
    };

    directAss.gi &#x3D; value;

    directAss.cra &#x3D; this.getConsolidatedRelief(value);
    directAss.ti &#x3D; directAss.gi - directAss.cra;
    if (directAss.ti &gt; 300000) {
      directAss.tax &#x3D; this.getGraduatingTax(directAss.ti);
    } else {
      directAss.tax &#x3D; this.getMinimumTax(directAss.ti, directAss.gi);
    }

    return directAss;
  }

  public CalculatePayee(values: any) {
    console.log(&quot;received &quot;, values);
    let total_income: number &#x3D; 0;
    let total_deductions: number &#x3D; 0;
    let taxable_income: number &#x3D; 0;
    this.dev_levy &#x3D;
      values.dev_levy &amp;&amp; typeof values.dev_levy &#x3D;&#x3D; &quot;string&quot;
        ? values.dev_levy.toLowerCase() &#x3D;&#x3D; &quot;yes&quot;
          ? 300
          : 0
        : 0;

    if (
      typeof values.is_consolidated &#x3D;&#x3D; &quot;string&quot; &amp;&amp;
      values.is_consolidated.toLowerCase() &#x3D;&#x3D; &quot;yes&quot;
    ) {
      return this.getTaxConsolidatedAmount(values);
    }

    if (
      typeof values[&quot;deduction_pension&quot;] &#x3D;&#x3D; &quot;string&quot; &amp;&amp;
      values[&quot;deduction_pension&quot;].toLowerCase() &#x3D;&#x3D; &quot;yes&quot;
    ) {
      this.allowable_deduction_pension +&#x3D;
        ((values[&quot;income_basic_salary&quot;] +
          values[&quot;income_housing&quot;] +
          values[&quot;income_transport&quot;]) *
          8) /
        100;
      this.pe &#x3D; this.allowable_deduction_pension * 12;
    }

    if (
      typeof values[&quot;deduction_nhf&quot;] &#x3D;&#x3D; &quot;string&quot; &amp;&amp;
      values[&quot;deduction_nhf&quot;].toLowerCase() &#x3D;&#x3D; &quot;yes&quot;
    ) {
      this.allowable_deduction_nhf +&#x3D;
        (values[&quot;income_basic_salary&quot;] * 2.5) / 100;

      this.nhs &#x3D; this.allowable_deduction_nhf * 12;
    }

    if (values[&quot;deduction_life_premium&quot;]) {
      this.li +&#x3D; values[&quot;deduction_life_premium&quot;] * 12;
    }

    if (values[&quot;deduction_nhis&quot;]) {
      this.nhis +&#x3D; values[&quot;deduction_nhis&quot;] * 12;
    }

    // IT RESOLVES TO NAN
    if (isNaN(this.allowable_deduction_nhf)) {
      this.allowable_deduction_nhf &#x3D; 0;
    }
    if (isNaN(this.allowable_deduction_pension)) {
      this.allowable_deduction_pension &#x3D; 0;
    }

    console.log(
      &quot;######&quot;,
      values[&quot;income_basic_salary&quot;],
      values[&quot;income_housing&quot;],
      values[&quot;income_transport&quot;]
    );

    for (var key in values) {
      let value &#x3D; values[key];
      if (value &#x3D;&#x3D; null) continue;

      if (key.indexOf(&quot;income&quot;) &gt; -1) {
        total_income +&#x3D; typeof value &#x3D;&#x3D; &quot;number&quot; ? value : 0;
      } else if (key.indexOf(&quot;deduction&quot;) &gt; -1) {
        total_deductions +&#x3D; typeof value &#x3D;&#x3D; &quot;number&quot; ? value : 0;
      }
    }

    total_income *&#x3D; 12;
    total_deductions *&#x3D; 12;
    total_deductions +&#x3D;
      this.allowable_deduction_pension * 12 + this.allowable_deduction_nhf * 12;
    this.gross_income &#x3D; total_income;
    let consolidatedRelief &#x3D; this.getConsolidatedRelief(total_income);
    this.cra &#x3D; consolidatedRelief;

    console.log(
      &quot;Total income&quot;,
      total_income,
      &quot;total deductions &quot;,
      total_deductions
    );

    console.log({
      gggg: this.allowable_deduction_pension,
      hhh: this.allowable_deduction_nhf,
    });

    console.log(&quot;conslidated relief&quot;, consolidatedRelief);
    this.total_deductions &#x3D; total_deductions;
    taxable_income &#x3D; total_income - total_deductions;

    if (total_income - consolidatedRelief &gt; 0) {
      taxable_income -&#x3D; consolidatedRelief;
      // total_deductions+&#x3D; consolidatedRelief;
      console.log(&quot;total deductions &quot;, this.total_deductions);
    } else {
      let tax &#x3D; total_income * 0.01;
      this.tax &#x3D; tax;
      return total_income * 0.01;
    }

    this.taxable_income &#x3D; taxable_income;

    let tax: number &#x3D; 0;
    console.log(
      &quot;Taxable income &quot;,
      taxable_income,
      &quot; gross income ***1 &quot;,
      this.gross_income
    );

    if (taxable_income &gt; 300000) {
      tax &#x3D; this.getGraduatingTax(taxable_income);
    } else {
      tax &#x3D; this.getMinimumTax(taxable_income, this.gross_income);
    }

    console.log(&quot;tax is &quot;, tax);
    tax &#x3D; parseInt(Number(tax).toFixed(2), 10);
    this.tax &#x3D; tax;
    return tax;
  }

  private getConsolidatedRelief(gross_income: number) {
    let twenty_percent &#x3D; (20 / 100) * gross_income;
    let relief &#x3D; (1 / 100) * gross_income;
    console.log(&quot;relief 20% of &quot;, gross_income, twenty_percent);
    console.log(&quot;relief 1% of &quot;, gross_income, relief);
    let result &#x3D; Math.max(200000, relief);
    result &#x3D; result + twenty_percent;
    return result;
  }

  private getMinimumTax(taxable_income: number, gross_income: number) {
    console.log(&quot;gross income &quot;, taxable_income, &quot; taxable &quot;, taxable_income);
    let ti &#x3D; (7 / 100) * taxable_income;
    let gi &#x3D; (1 / 100) * gross_income;
    return ti &gt; gi ? ti : gi;
  }

  private getTaxConsolidatedAmount(values) {
    console.log({ values });
    const formValues &#x3D; { ...values };
    let pension &#x3D; 0;
    let nhf &#x3D; 0;
    let nhis &#x3D; 0;
    let consolidatedRelief &#x3D; 0;
    let taxable_income &#x3D; 0;
    let total_income &#x3D;
      ((formValues.income_basic_salary || 0) +
        (formValues.income_housing || 0) +
        (formValues.income_others || 0) +
        (formValues.income_transport || 0)) *
      12;
    this.gross_income &#x3D; total_income;
    if (
      formValues.deduction_pension &#x3D;&#x3D; &quot;yes&quot; ||
      formValues.deduction_pension &#x3D;&#x3D; &quot;Yes&quot;
    ) {
      pension &#x3D;
        ((((formValues[&quot;income_basic_salary&quot;] || 0) +
          (formValues[&quot;income_housing&quot;] || 0) +
          (formValues[&quot;income_transport&quot;] || 0)) *
          8) /
          100) *
        12;
    }

    if (
      typeof formValues[&quot;deduction_nhf&quot;] &#x3D;&#x3D; &quot;string&quot; &amp;&amp;
      formValues[&quot;deduction_nhf&quot;].toLowerCase() &#x3D;&#x3D; &quot;yes&quot;
    ) {
      nhf +&#x3D;
        (((formValues.income_basic_salary || 0) +
          (formValues.income_housing || 0) +
          (formValues.income_others || 0) +
          (formValues.income_transport || 0) * 2.5) /
          100) *
        12;
    }

    if (formValues[&quot;deduction_life_premium&quot;]) {
      this.li +&#x3D; formValues[&quot;deduction_life_premium&quot;] * 12;
    }

    if (formValues[&quot;deduction_nhis&quot;]) {
      this.nhis +&#x3D; formValues[&quot;deduction_nhis&quot;] * 12;
    }

    consolidatedRelief &#x3D; this.getConsolidatedRelief(total_income);
    this.cra &#x3D; consolidatedRelief;

    console.log(&quot;conslidated relief&quot;, consolidatedRelief);
    this.nhs &#x3D; nhf;
    this.pe &#x3D; pension;
    this.total_deductions &#x3D; pension + nhf + nhis;
    taxable_income &#x3D; total_income - this.total_deductions;
    console.log({ &quot; **************1&quot;: taxable_income });
    this.taxable_income &#x3D; taxable_income;

    if (total_income - consolidatedRelief &gt; 0) {
      taxable_income -&#x3D; consolidatedRelief;
      console.log(&quot;total deductions &quot;, this.total_deductions);
    } else {
      let tax &#x3D; total_income * 0.01;
      this.tax &#x3D; tax;
      return total_income * 0.01;
    }

    this.taxable_income &#x3D; taxable_income;

    let tax: number &#x3D; 0;
    console.log({ &quot; **************2&quot;: { taxable_income, total_income } });
    if (taxable_income &gt; 300000) {
      tax &#x3D; this.getGraduatingTax(taxable_income);
    } else {
      tax &#x3D; this.getMinimumTax(taxable_income, total_income);
    }

    console.log(&quot;tax is &quot;, tax);
    tax &#x3D; parseInt(Number(tax).toFixed(2), 10);
    this.tax &#x3D; tax;
    return tax;
  }

  private getGraduatingTax(income: number) {
    let level1: number &#x3D; 0,
      level2: number &#x3D; 0,
      level3: number &#x3D; 0,
      level4: number &#x3D; 0,
      level5: number &#x3D; 0,
      level6: number &#x3D; 0,
      amount_remainder: number &#x3D; income,
      chargeable: boolean &#x3D; true;

    if (amount_remainder &lt; 300000) {
      level1 &#x3D; (7 / 100) * amount_remainder;
      return level1;
    } else {
      level1 &#x3D; (7 / 100) * 300000;
      amount_remainder -&#x3D; 300000;
    }

    if (amount_remainder &lt; 300000) {
      level2 &#x3D; (11 / 100) * amount_remainder;
      return level1 + level2;
    } else {
      level2 &#x3D; (11 / 100) * 300000;
      amount_remainder -&#x3D; 300000;
    }

    if (amount_remainder &lt; 500000) {
      level3 &#x3D; (15 / 100) * amount_remainder;
      return level1 + level2 + level3;
    } else {
      level3 &#x3D; (15 / 100) * 500000;
      amount_remainder -&#x3D; 500000;
    }

    if (amount_remainder &lt; 500000) {
      level4 &#x3D; (19 / 100) * amount_remainder;
      return level1 + level2 + level3 + level4;
    } else {
      level4 &#x3D; (19 / 100) * 500000;
      amount_remainder -&#x3D; 500000;
    }

    if (amount_remainder &lt; 1600000) {
      level5 &#x3D; (21 / 100) * amount_remainder;
      return level1 + level2 + level3 + level4 + level5;
    } else {
      level5 &#x3D; (21 / 100) * 1600000;
      amount_remainder -&#x3D; 1600000;
    }

    level6 &#x3D; amount_remainder * (24 / 100);
    // -----------------------------------
    //
    //------------------------------------
    return level1 + level2 + level3 + level4 + level5 + level6;
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'DirectAssment.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
