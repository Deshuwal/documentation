<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>PSIRS documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">PSIRS documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  SectorAuddit</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/views/mda-admin/audit_target/audit_target.component.ts</code>
        </p>




        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#expected_amount_monthly" 
>
                                            expected_amount_monthly
                                        </a>
                                </li>
                                <li>
                                        <a href="#id" 
>
                                            id
                                        </a>
                                </li>
                                <li>
                                        <a href="#name" 
>
                                            name
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="expected_amount_monthly"></a>
                                        <span class="name "><b>expected_amount_monthly</b>
                                            <a href="#expected_amount_monthly">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>expected_amount_monthly:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="id"></a>
                                        <span class="name "><b>id</b>
                                            <a href="#id">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name "><b>name</b>
                                            <a href="#name">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, ViewChild } from &quot;@angular/core&quot;;
import { echartStyles } from &quot;src/app/shared/echart-styles&quot;;
import { ProductService } from &quot;src/app/shared/services/product.service&quot;;
import { LocalStoreService } from &quot;src/app/shared/services/local-store.service&quot;;
import { NgbModal } from &quot;@ng-bootstrap/ng-bootstrap&quot;;
import { SharedAnimations } from &quot;src/app/shared/animations/shared-animations&quot;;
import { FormGroup, FormBuilder, Validators } from &quot;@angular/forms&quot;;
import { HttpService } from &quot;src/app/shared/services/http.service&quot;;
import { ToastrService } from &quot;ngx-toastr&quot;;
import { AssessmentService } from &quot;src/app/shared/services/assessment.service&quot;;
import { Utils } from &quot;src/app/shared/utils&quot;;

import { ActivatedRoute } from &quot;@angular/router&quot;;

interface SectorAuddit {
	expected_amount_monthly: number;
	name: string;
	id: number;
}

import {
	Router,
	RouteConfigLoadStart,
	ResolveStart,
	RouteConfigLoadEnd,
	ResolveEnd,
} from &quot;@angular/router&quot;;
import { BreadcrumbService } from &quot;src/app/shared/services/breadcrumb.service&quot;;

@Component({
	selector: &quot;app-dashboard-v2&quot;,
	templateUrl: &quot;./audit_target.component.html&quot;,
	styleUrls: [&quot;./audit_target.component.scss&quot;],
	animations: [SharedAnimations],
})
export class AuditTargetComponent implements OnInit {
	mdas: any;
	taxItemForm: FormGroup;
	editMode: boolean;
	loading: boolean &#x3D; false;
	editTitle: string &#x3D; &quot;&quot;;
	assessments: any;
	taxItems: any;
	isInputDisplayed &#x3D; false;

	agents: any[] &#x3D; [
		{ name: &quot;Male&quot;, id: 102348 },

		{ name: &quot;Female&quot;, id: 102348 },

		{ name: &quot;Trans&quot;, id: 102348 },

		{ name: &quot;Other&quot;, id: 102348 },
	];

	@ViewChild(&quot;modalConfirm&quot;, { static: false }) private modalContent;

	@ViewChild(&quot;modalCreate&quot;, { static: false }) private addModal;

	userProfile: any;

	status: any;
	constructor(
		private dl: HttpService,
		private modalService: NgbModal,
		private toastr: ToastrService,
		private fb: FormBuilder,
		private localStore: LocalStoreService,
		private route: ActivatedRoute,
		private assessmentService: AssessmentService,
		private breadcrumb: BreadcrumbService
	) {}

	ngOnInit() {
		console.log(
			&quot;testing utils&quot;,
			Utils.getTimeIntervalPhpTimeStamp(Date.now() / 1000)
		);

		this.userProfile &#x3D; this.localStore.getItem(&quot;user&quot;);

		this.breadcrumb.setCrumbItem(&quot;setupAuditTarget&quot;);

		this.route.params.forEach((e: any) &#x3D;&gt; {
			if (e.status) this.status &#x3D; e.status;
		});

		this.loading &#x3D; true;

		setTimeout(() &#x3D;&gt; {
			this.loading &#x3D; false;
		}, 4000);

		this.route.params.subscribe((params) &#x3D;&gt; {
			this.status &#x3D; params[&quot;status&quot;];
			this.loadAssessments(); // reset and set based on new parameter this time
		});

		console.log(&quot;param is &quot;, this.status);

		//this.loadTaxItems();
		//this.loadMdas()

		this.taxItemForm &#x3D; this.fb.group({
			id: [&quot;&quot;],
			title: [&quot;&quot;, Validators.required],
			mda_id: [&quot;&quot;, Validators.required],
			rules: [&quot;&quot;],
		});
	}

	timeAgo(timestamp: number) {
		return Utils.getTimeIntervalPhpTimeStamp(timestamp);
	}

	submitTaxItem() {
		if (
			this.taxItemForm.value.mda_id &#x3D;&#x3D; null ||
			parseInt(this.taxItemForm.value.mda_id) &lt; 1
		) {
			return;
		}

		this.loading &#x3D; true;

		this.dl.doPost(&quot;/tax_items/save&quot;, this.taxItemForm.value).subscribe(
			(res) &#x3D;&gt; {
				console.log(&quot;result saving&quot;, res);
				this.editMode &#x3D; false;
				this.loading &#x3D; false;
				this.loadTaxItems();
			},
			(error) &#x3D;&gt; {
				this.loading &#x3D; false;
				console.log(&quot;error saving tax item&quot;, error);
			}
		);
	}

	loadTaxItems() {
		this.loading &#x3D; true;
		this.dl.doGet(&quot;/tax_items/list&quot;).subscribe(
			(res) &#x3D;&gt; {
				console.log(&quot;fetched taxitems &quot;, res);
				this.taxItems &#x3D; res;
				this.loading &#x3D; false;
			},
			(err) &#x3D;&gt; {
				this.loading &#x3D; false;
				console.log(&quot;error fetching tax items&quot;, err);
			}
		);
	}

	inputId;
	inputAmount &#x3D; 0;

	onNumberChange(e) {
		this.inputAmount &#x3D; e;
	}

	submitInput() {
		this.dl
			.doPatch(
				&#x60;/risk_based_audit/audit_target?expected_amount&#x3D;${this.inputAmount}&amp;id&#x3D;${this.inputId}&#x60;,
				{ expected_amount: this.inputAmount, id: this.inputId }
			)
			.subscribe(
				(res: SectorAuddit[]) &#x3D;&gt; {
					console.log(&quot;fetched assessments &quot;, res);
					this.loading &#x3D; false;
					this.loadAssessments();
				},
				(err) &#x3D;&gt; {
					this.loading &#x3D; false;
					console.log(&quot;error fetching tax items&quot;, err);
				}
			);
	}

	add(amount, id) {
		this.inputAmount &#x3D; amount;
		this.inputId &#x3D; id;
		this.assessments &#x3D; this.assessments.map((item) &#x3D;&gt;
			item.id &#x3D;&#x3D; id ? { ...item, isOpen: true } : item
		);
	}

	loadAssessments() {
		this.loading &#x3D; true;

		let url &#x3D; &quot;/risk_based_audit/audit_target&quot;;

		if (this.status !&#x3D; undefined) {
			url &#x3D; url + &quot;/&quot; + this.status;
		}

		this.dl.doGet(url).subscribe(
			(res: any) &#x3D;&gt; {
				console.log(&quot;fetched assessments &quot;, res);
				this.assessments &#x3D; res.data.map((el) &#x3D;&gt; ({ ...el, isOpen: false }));
				this.loading &#x3D; false;
			},
			(err) &#x3D;&gt; {
				this.loading &#x3D; false;
				console.log(&quot;error fetching tax items&quot;, err);
			}
		);
	}

	loadMdas() {
		this.loading &#x3D; true;
		this.dl.doGet(&quot;/mdas/list&quot;).subscribe(
			(res) &#x3D;&gt; {
				console.log(&quot;fetched mda &quot;, res);
				this.mdas &#x3D; res;
				this.loading &#x3D; false;
			},
			(err) &#x3D;&gt; {
				this.loading &#x3D; false;
				console.log(&quot;error fetching mda&quot;, err);
			}
		);
	}

	deleteInvoice(id, modal) {
		this.loading &#x3D; true;
		this.modalService
			.open(modal, { ariaLabelledBy: &quot;modal-basic-title&quot;, centered: true })
			.result.then(
				(result) &#x3D;&gt; {
					this.dl.doGet(&quot;/tax_items/delete/&quot; + id).subscribe((res) &#x3D;&gt; {
						this.loading &#x3D; false;
						this.toastr.success(&quot;Tax Item Deleted!&quot;, &quot;Success!&quot;, {
							timeOut: 3000,
						});
						this.loadTaxItems();
					});
				},
				(reason) &#x3D;&gt; {
					this.loading &#x3D; false;
				}
			);
	}

	assessmentForDisplay: any &#x3D; {};
	displayPayee: any;
	dynamicSummary: boolean &#x3D; false;
	payeeSummary: boolean &#x3D; false;
	directAssessmentSummary: boolean &#x3D; false;

	viewAssessment(assessment: any) {
		this.payeeSummary &#x3D; false;
		this.directAssessmentSummary &#x3D; false;

		console.log(&quot;view assessment &quot;, assessment);

		//if assessment is payee or licence
		if (assessment.tax_item_id &#x3D;&#x3D; 13) {
			console.log(&quot;displaying paye &quot;, assessment.rules);
			/* this.displayPayee &#x3D; this.assessmentService.arrangePayeeFormDataForDisplay(JSON.parse(assessment.form_items), null);
			console.log(&quot;displaying payee &quot;, this.displayPayee);
			this.dynamicSummary &#x3D; true;
	
			this.displayPayee.push({label:&quot;Billing Ref&quot;, value:assessment.billing_ref});
			this.payeeSummary &#x3D; true;
		
			this.modalService.open(this.modalContent, { ariaLabelledBy: &#x27;modal-basic-title&#x27;, centered: true }); 
			return; */

			try {
				assessment.rules &#x3D; JSON.parse(assessment.rules);
			} catch (e) {}
			this.dynamicSummary &#x3D; true;
			this.payeeSummary &#x3D; true;
			this.assessmentForDisplay &#x3D; Object.assign({}, assessment);
			this.assessmentForDisplay.form_items &#x3D; JSON.parse(assessment.form_items);

			this.displayPayee &#x3D; this.assessmentService.arrangePayeeFormDataForDisplay(
				this.assessmentForDisplay.form_items,
				assessment.rules
			);

			console.log(&quot;rules &quot;, assessment.rules);

			this.assessmentForDisplay.tin &#x3D; this.userProfile.tin;

			this.modalService.open(this.modalContent, {
				ariaLabelledBy: &quot;modal-basic-title&quot;,
				centered: true,
			});

			console.log(&quot;Display Payee&quot;, this.displayPayee);
			return;
		} else if (assessment.rules.length &lt; 3 &amp;&amp; assessment.tax_item_id &#x3D;&#x3D; 14) {
			this.displayPayee &#x3D;
				this.assessmentService.arrangeDirectAssessmentFormDataForDisplay(
					JSON.parse(assessment.form_items)
				);
			console.log(&quot;displaying direct assessment &quot;, this.displayPayee);
			this.dynamicSummary &#x3D; true;
			this.directAssessmentSummary &#x3D; true;

			this.displayPayee.push({
				label: &quot;Billing Ref&quot;,
				value: assessment.billing_ref,
			});

			this.modalService.open(this.modalContent, {
				ariaLabelledBy: &quot;modal-basic-title&quot;,
				centered: true,
			});
			return;
		}

		this.dynamicSummary &#x3D; false;
		this.assessmentForDisplay.billing_ref &#x3D; assessment.billing_ref;
		this.assessmentForDisplay.id &#x3D; assessment.id;

		this.assessmentForDisplay.mda &#x3D; assessment.mda;
		this.assessmentForDisplay.tax_item &#x3D; assessment.display
			? JSON.parse(assessment.display).tax_item
			: assessment.tax_item;
		this.assessmentForDisplay.tin &#x3D; assessment.tin;
		this.assessmentForDisplay.amount &#x3D; assessment.amount;

		this.modalService.open(this.modalContent, {
			ariaLabelledBy: &quot;modal-basic-title&quot;,
			centered: true,
		});
	}

	makePaymentForTaxItem(itemId: number) {
		console.log(&quot;gotten id &quot;, itemId);

		let item &#x3D; this.getPaymentItem(itemId);

		console.log(&quot;gotten item &quot;, item);
		let amount &#x3D; 0;

		if (item.mda_id &#x3D;&#x3D; 3 &amp;&amp; item.tax_item_id &#x3D;&#x3D; 13) {
			amount &#x3D; item.rules.tax;
		}

		let win: any &#x3D; window;
		this.pendingItem &#x3D; item;
		win.payWithPaystack(amount, this);

		console.log(&quot;Called paystack&quot;);
	}

	pendingItem: any;
	paymentSucceeded() {
		console.log(&quot;updating &quot;, this.assessmentForDisplay.id);
		this.loading &#x3D; true;

		let url: string &#x3D; &quot;assessment/update_assessment/&quot; + this.pendingItem.id;
		url &#x3D; url + &quot;/1&quot;;
		console.log(&quot;url is &quot;, url);
		this.dl.doGet(url).subscribe(
			(res) &#x3D;&gt; {
				this.loading &#x3D; false;
				this.toastr.success(&quot;Success&quot;, &quot;Payment Successful!&quot;, {
					timeOut: 10000,
					closeButton: true,
					progressBar: true,
				});
				this.modalService.dismissAll(&quot;dismiss&quot;);
			},
			(err) &#x3D;&gt; {
				this.loading &#x3D; false;
				this.toastr.error(&quot;Failed!&quot;, &quot;Payment Failed&quot;, {
					timeOut: 10000,
					closeButton: true,
					progressBar: true,
				});
				this.modalService.dismissAll(&quot;dismiss&quot;);
			}
		);
	}

	save() {
		this.loading &#x3D; true;

		setTimeout(() &#x3D;&gt; {
			this.loading &#x3D; false;
			this.toastr.success(&quot;Agent created!&quot;, &quot;Success!&quot;, {
				timeOut: 10000,
				closeButton: true,
				progressBar: true,
			});
			this.modalService.dismissAll(&quot;&quot;);
			this.ngOnInit();
		}, 4000);
	}

	getPaymentItem(id: number) {
		console.log(&quot;Getting assessment &quot;, id, this.assessments);

		for (let i: number &#x3D; 0; i &lt; this.assessments.length; i++) {
			let thisId: number &#x3D; parseInt(this.assessments[i].id);
			console.log(&quot;comparing &quot;, thisId, id);
			if (thisId &#x3D;&#x3D; id) {
				return this.assessments[i];
			}
		}

		return null;
	}

	editTaxItem(taxItem: any &#x3D; null) {
		if (taxItem) {
			this.editTitle &#x3D; &quot;Edit TaxItem&quot;;
			this.taxItemForm.setValue({
				id: taxItem.id,
				rules: taxItem.rules,
				title: taxItem.title,
				mda_id: taxItem.mda_id,
			});
		} else {
			this.editTitle &#x3D; &quot;Create TaxItem&quot;;
			this.taxItemForm.setValue({ title: &quot;&quot;, mda_id: &quot;&quot;, id: &quot;&quot;, rules: &quot;&quot; });
		}

		this.editMode &#x3D; true;
	}

	parsePhpDate(date: string) {
		return Utils.parsePhpDate(date);
	}

	formatNumber(x: number) {
		return x.toString().replace(/\B(?&#x3D;(\d{3})+(?!\d))/g, &quot;,&quot;);
	}
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'SectorAuddit.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
